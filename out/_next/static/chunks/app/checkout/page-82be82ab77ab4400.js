(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[279],{1977:(e,s,t)=>{Promise.resolve().then(t.bind(t,8754))},2939:(e,s,t)=>{"use strict";t.d(s,{B:()=>r});var a=t(3464),l=t(8070);let r=async()=>{let e=localStorage.getItem("refresh");try{let s=await a.A.post("".concat(l.A,"/auth/token/refresh/"),{refresh:e});return localStorage.setItem("access",s.data.access),s.data.access}catch(e){return localStorage.removeItem("access"),localStorage.removeItem("refresh"),window.location.href="/login",null}}},8754:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>p});var a=t(5155),l=t(2115),r=t(5695),i=t(7288),n=t(9010),c=t(6766),d=t(3464),o=t(8070),m=t(2939),x=t(5970),h=t(7927);let u=(0,t(5028).default)(()=>t.e(27).then(t.bind(t,27)),{loadableGenerated:{webpack:()=>[27]},ssr:!1});function p(){let{language:e,setLanguage:s,t}=(0,h.o)(),c=(0,r.useRouter)(),[x,u]=(0,l.useState)(1),[p,N]=(0,l.useState)("payme"),[v,_]=(0,l.useState)(!1),[w,k]=(0,l.useState)([]),[S,q]=(0,l.useState)(null),[z,A]=(0,l.useState)(!0),[I,C]=(0,l.useState)(null),[B,E]=(0,l.useState)({firstName:"",phone:"",lat:"",long:"",address:""}),O=async e=>{try{let s=await d.A.get("".concat(o.A,"/api/cart/"),{headers:{Authorization:"Bearer ".concat(e)}}),t=s.data.data.results[0],a={id:t.id,total_price:t.total_price};q(a);let l=s.data.data.results[0].cart_items.map(e=>({id:e.product.id.toString(),name:e.product.title,price:e.product.price,quantity:e.quantity,image:e.product.image}));k(l),A(!1)}catch(e){var s;if((null==(s=e.response)?void 0:s.status)===401){let e=await (0,m.B)();e?O(e):(C("Failed to authenticate. Please log in again."),A(!1))}else C("Failed to fetch cart items."),A(!1)}};(0,l.useEffect)(()=>{let e=localStorage.getItem("access");e?O(e):(0,m.B)().then(e=>{e?O(e):(C("Please log in to view your cart."),A(!1),c.push("/login"))})},[c]),w.reduce((e,s)=>e+s.price*s.quantity,0);let P=async()=>{_(!0);try{let e=await (0,m.B)();if(!e)throw Error("Authentication failed");let s={first_name:B.firstName,phone:B.phone,payment_type:p,lat:parseFloat(B.lat)||0,lon:parseFloat(B.long)||0,order_item:w.map(e=>({product:parseInt(e.id),quantity:e.quantity})),address:B.address};console.log("Order Payload:",JSON.stringify(s,null,2));let{id:t,created_at:a,status:l,payment_status:r}=(await d.A.post("".concat(o.A,"/api/order/"),s,{headers:{Authorization:"Bearer ".concat(e)}})).data.data;c.push("/order-success?id=".concat(t,"&created_at=").concat(encodeURIComponent(a),"&status=").concat(l,"&payment_status=").concat(r))}catch(i){var e,s,t,a,l;console.error("Order Error:",i);let r=(null==(s=i.response)||null==(e=s.data)?void 0:e.detail)||(null==(a=i.response)||null==(t=a.data)?void 0:t.message)||Object.values((null==(l=i.response)?void 0:l.data)||{}).join(", ")||"Buyurtma yuborishda xatolik yuz berdi.";alert("Error: ".concat(r))}finally{_(!1)}};return z?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:"Loading..."}):I?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:I}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(i.A,{}),(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:t("checkout_title")}),(0,a.jsx)("div",{className:"flex items-center space-x-4",children:(0,a.jsx)(g,{step:x})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,a.jsxs)("div",{className:"lg:col-span-2",children:[1===x&&(0,a.jsx)(j,{shippingInfo:B,setShippingInfo:E,onNext:()=>u(2)}),2===x&&(0,a.jsx)(b,{paymentMethod:p,setPaymentMethod:N,onNext:()=>u(3),onBack:()=>u(1)}),3===x&&(0,a.jsx)(y,{shippingInfo:B,cartItems:w,paymentMethod:p,onBack:()=>u(2),onPlaceOrder:P,isProcessing:v})]}),(0,a.jsx)("div",{className:"lg:col-span-1",children:(0,a.jsx)(f,{cartItems:w,total:(null==S?void 0:S.total_price)||"0.00"})})]})]}),(0,a.jsx)(n.A,{})]})}let g=e=>{let{step:s}=e,{t}=(0,h.o)();return(0,a.jsx)(a.Fragment,{children:[t("shipping"),t("payment"),t("review")].map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center ".concat(s>=t+1?"text-green-600":"text-gray-400"),children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ".concat(s>=t+1?"bg-green-600 text-white":"bg-gray-200"),children:t+1}),(0,a.jsx)("span",{className:"ml-2",children:e}),t<2&&(0,a.jsx)("div",{className:"w-8 h-px bg-gray-300 mx-2"})]},e))})},j=e=>{let{shippingInfo:s,setShippingInfo:t,onNext:r}=e,[i,n]=(0,l.useState)(null),{t:c}=(0,h.o)();return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:c("shipping_info_title")}),(0,a.jsxs)("form",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-gray-800 font-medium mb-2",children:c("first_name_label")}),(0,a.jsx)("input",{type:"text",value:s.firstName,onChange:e=>t({...s,firstName:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:c("first_name_placeholder"),required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-gray-800 font-medium mb-2",children:c("phone_number_label")}),(0,a.jsx)(x._g,{mask:"+998-00-000-00-00",definitions:{0:/[0-9]/},lazy:!1,overwrite:!0,value:s.phone,onAccept:e=>{t({...s,phone:e})},placeholder:"+998-__-___-__-__",className:"w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500"}),i&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:i})]})]}),(0,a.jsx)(u,{onSelect:(e,a,l)=>t({...s,address:e,lat:a,long:l})}),(0,a.jsx)("button",{type:"button",onClick:r,className:"w-full bg-green-600 text-white py-3 rounded-xl hover:bg-green-700 font-semibold shadow-md transition-all text-base",disabled:!s.firstName||!s.phone||!s.address||null!==i,children:c("continue_to_payment")})]})]})},b=e=>{let{paymentMethod:s,setPaymentMethod:t,onNext:l,onBack:r}=e,{t:i}=(0,h.o)();return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:i("payment_method")}),(0,a.jsx)("div",{className:"space-y-4",children:["payme","click"].map(e=>(0,a.jsx)("div",{className:"border border-gray-200 rounded-lg p-4",children:(0,a.jsxs)("label",{className:"flex items-center cursor-pointer",children:[(0,a.jsx)("input",{type:"radio",name:"payment",value:e,checked:s===e,onChange:e=>t(e.target.value),className:"w-4 h-4 text-green-600"}),(0,a.jsxs)("div",{className:"ml-3 flex items-center",children:[(0,a.jsx)(c.default,{src:"/images/".concat(e,".png"),alt:e,width:48,height:32,className:"object-contain"}),(0,a.jsx)("span",{className:"ml-3 font-medium text-teal-700 capitalize",children:e})]})]})},e))}),(0,a.jsxs)("div",{className:"flex space-x-4 mt-6",children:[(0,a.jsx)("button",{onClick:r,className:"flex-1 border border-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-50 font-medium",children:i("back_button")}),(0,a.jsx)("button",{onClick:l,className:"flex-1 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 font-medium",children:i("place_order_button")})]})]})},y=e=>{let{shippingInfo:s,cartItems:t,paymentMethod:l,onBack:r,onPlaceOrder:i,isProcessing:n}=e,{t:c}=(0,h.o)();return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:c("order_review_title")}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-zinc-500 mb-2 flex items-center gap-2",children:c("recipient_label")}),(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-xl shadow-sm space-y-2 border border-gray-200",children:[(0,a.jsxs)("p",{className:"text-lg font-semibold text-zinc-900 flex items-center gap-2",children:[(0,a.jsx)("i",{className:"ri-user-line text-teal-600"})," ",s.firstName]}),(0,a.jsxs)("p",{className:"text-gray-700 flex items-center gap-2",children:[(0,a.jsx)("i",{className:"ri-phone-line text-green-500"})," ",s.phone]}),(0,a.jsxs)("p",{className:"text-gray-700 flex items-start gap-2",children:[(0,a.jsx)("i",{className:"ri-map-pin-line text-red-500 mt-0.5"})," ",s.address]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-700 mb-4 flex items-center gap-2",children:[(0,a.jsx)("i",{className:"ri-wallet-3-line text-blue-500"})," ",c("payment_method")]}),(0,a.jsx)("p",{className:"text-gray-600 pl-6 capitalize",children:l})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-700 mb-4 flex items-center gap-2",children:[(0,a.jsx)("i",{className:"ri-shopping-cart-2-line text-purple-500"})," ",c("order_items")]}),(0,a.jsx)("div",{className:"divide-y divide-gray-200 rounded-lg border border-gray-100 overflow-hidden",children:t.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-4 p-4",children:[(0,a.jsx)("img",{src:e.image,alt:e.name,className:"w-14 h-14 object-cover rounded-lg border"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-800",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:[c("quantity"),": ",e.quantity]})]}),(0,a.jsxs)("span",{className:"font-semibold text-gray-700",children:[(e.price*e.quantity).toLocaleString("uz-UZ")," so'm"]})]},e.id))})]})]}),(0,a.jsxs)("div",{className:"flex space-x-4 mt-6",children:[(0,a.jsx)("button",{onClick:r,className:"flex-1 border border-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-50 font-medium",children:c("back_button")}),(0,a.jsx)("button",{onClick:i,disabled:n,className:"flex-1 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 font-medium disabled:opacity-50",children:n?c("processing"):c("place_order_button")})]})]})},f=e=>{let{cartItems:s,total:t}=e,{language:l,setLanguage:r,t:i}=(0,h.o)();return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6 sticky top-8",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:i("order_summary_title")}),(0,a.jsx)("div",{className:"space-y-3 mb-6",children:s.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("img",{src:e.image,alt:e.name,className:"w-12 h-12 object-cover rounded"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-sm",children:e.name}),(0,a.jsxs)("p",{className:"text-gray-500 text-sm",children:[i("quantity"),": ",e.quantity]})]})]}),(0,a.jsxs)("span",{className:"font-medium",children:[(e.price*e.quantity).toLocaleString("uz-UZ")," so'm"]})]},e.id))}),(0,a.jsxs)("div",{className:"space-y-3 border-t border-gray-200 pt-4",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:i("total")}),(0,a.jsxs)("span",{className:"font-medium",children:[Number(t).toLocaleString("uz-UZ")," so'm"]})]}),(0,a.jsx)("div",{className:"border-t border-gray-200 pt-3",children:(0,a.jsxs)("div",{className:"flex justify-between text-lg font-semibold",children:[(0,a.jsx)("span",{children:i("total_label")}),(0,a.jsxs)("span",{children:[Number(t).toLocaleString("uz-UZ")," so'm"]})]})})]})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[115,970,701,425,441,684,358],()=>s(1977)),_N_E=e.O()}]);
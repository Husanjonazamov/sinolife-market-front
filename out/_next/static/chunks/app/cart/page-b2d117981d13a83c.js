(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5],{672:(e,t,a)=>{Promise.resolve().then(a.bind(a,5833))},2939:(e,t,a)=>{"use strict";a.d(t,{B:()=>i});var s=a(3464),r=a(8070);let i=async()=>{let e=localStorage.getItem("refresh");try{let t=await s.A.post("".concat(r.A,"/auth/token/refresh/"),{refresh:e});return localStorage.setItem("access",t.data.access),t.data.access}catch(e){return localStorage.removeItem("access"),localStorage.removeItem("refresh"),window.location.href="/login",null}}},5833:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>g});var s=a(5155),r=a(2115),i=a(6874),c=a.n(i),l=a(7288),n=a(9010),o=a(3464),d=a(8070),m=a(2939);let h=async(e,t)=>{let a="".concat(d.A,"/api/cart-item/").concat(e,"/"),s=localStorage.getItem("access");try{return await o.A.patch(a,{quantity:t},{headers:{Authorization:"Bearer ".concat(s)}}),!0}catch(e){if(e.response&&401===e.response.status){let e=await (0,m.B)();if(!e)throw Error("Sessiya tugadi");return await o.A.patch(a,{quantity:t},{headers:{Authorization:"Bearer ".concat(e)}}),!0}throw console.error(e),Error("Miqdor yangilashda xatolik")}},x=async e=>{let t="".concat(d.A,"/api/cart-item/").concat(e,"/remove/"),a=localStorage.getItem("access");try{return await o.A.delete(t,{headers:{Authorization:"Bearer ".concat(a)}}),!0}catch(e){if(e.response&&401===e.response.status){let e=await (0,m.B)();if(!e)throw Error("Sessiya tugadi");return await o.A.delete(t,{headers:{Authorization:"Bearer ".concat(e)}}),!0}throw console.error(e),Error("Mahsulotni o‘chirishda xatolik")}};var u=a(7927);function g(){let[e,t]=(0,r.useState)([]),[a,i]=(0,r.useState)(!0),[g,p]=(0,r.useState)(""),[y,j]=(0,r.useState)(0),[b,f]=(0,r.useState)(!1),{language:N,setLanguage:v,t:w}=(0,u.o)(),k=async()=>{try{var e;let a,s="".concat(d.A,"/api/cart/"),r=localStorage.getItem("access");try{a=await o.A.get(s,{headers:{Authorization:"Bearer ".concat(r)}})}catch(e){if(e.response&&401===e.response.status){let e=await (0,m.B)();if(!e)return void alert("Sessiya tugadi. Qaytadan kirishingiz kerak.");a=await o.A.get(s,{headers:{Authorization:"Bearer ".concat(e)}})}else throw e}let i=((null==(e=a.data.data.results[0])?void 0:e.cart_items)||[]).map(e=>({id:e.id,name:e.product.title,price:e.product.discounted_price,originalPrice:e.product.price!==e.product.discounted_price?e.product.price:void 0,image:e.product.image,quantity:e.quantity,category:e.product.category.title}));t(i)}catch(e){console.error("Savatni olishda xatolik:",e),alert("Savatni olishda xatolik")}finally{i(!1)}};(0,r.useEffect)(()=>{k()},[]);let S=async(e,a)=>{if(!(a<1))try{await h(e,a),t(t=>t.map(t=>t.id===e?{...t,quantity:a}:t))}catch(e){console.error(e),alert("Miqdorni yangilashda xatolik yuz berdi")}},A=async e=>{try{await x(e),t(t=>t.filter(t=>t.id!==e))}catch(e){console.error(e),alert("Mahsulotni o‘chirishda xatolik yuz berdi")}},_=e.reduce((e,t)=>e+t.price*t.quantity,0),z=_*y,q=_-z;return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)(l.A,{}),(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:w("cart_title")}),(0,s.jsx)("p",{className:"text-gray-600",children:w("cart_description")})]}),a?(0,s.jsx)("div",{className:"text-center py-16 text-gray-500",children:"Yuklanmoqda..."}):0===e.length?(0,s.jsxs)("div",{className:"text-center py-16",children:[(0,s.jsx)("i",{className:"ri-shopping-cart-line text-6xl text-gray-300 mb-4"}),(0,s.jsx)("h2",{className:"text-2xl font-semibold text-gray-700 mb-2",children:"Your cart is empty"}),(0,s.jsx)("p",{className:"text-gray-500 mb-8",children:"Add some products to get started"}),(0,s.jsxs)(c(),{href:"/products",className:"inline-flex items-center px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors cursor-pointer whitespace-nowrap",children:[(0,s.jsx)("i",{className:"ri-shopping-bag-line mr-2"}),w("continue_shopping")]})]}):(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,s.jsx)("div",{className:"lg:col-span-2",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,s.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:[w("cart_items_title")," (",e.length,")"]}),(0,s.jsx)("div",{className:"space-y-6",children:e.map(e=>(0,s.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:space-x-4 py-4 border-b border-gray-200 last:border-b-0",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4 w-full",children:[(0,s.jsx)("img",{src:e.image,alt:e.name,className:"w-20 h-20 object-cover rounded-lg"}),(0,s.jsxs)("div",{className:"mt-2",children:[(0,s.jsx)("div",{className:"text-base font-bold text-teal-700",children:e.name}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("span",{className:"text-lg font-semibold text-green-600",children:[e.price.toLocaleString("uz-UZ")," so'm"]}),e.originalPrice&&(0,s.jsxs)("span",{className:"ml-2 text-sm text-gray-400 line-through",children:[e.originalPrice.toLocaleString("uz-UZ")," so'm"]})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between mt-4 md:mt-0 md:justify-end w-full md:w-auto space-x-4",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("button",{onClick:()=>S(e.id,e.quantity-1),className:"w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-100 cursor-pointer",children:(0,s.jsx)("i",{className:"ri-subtract-line text-gray-600"})}),(0,s.jsx)("span",{className:"min-w-[30px] text-center font-medium text-base",children:e.quantity}),(0,s.jsx)("button",{onClick:()=>S(e.id,e.quantity+1),className:"w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-100 cursor-pointer",children:(0,s.jsx)("i",{className:"ri-add-line text-gray-600"})})]}),(0,s.jsx)("button",{onClick:()=>A(e.id),className:"text-red-500 hover:text-red-700 p-2 cursor-pointer",children:(0,s.jsx)("i",{className:"ri-delete-bin-line text-xl"})})]})]},e.id))}),(0,s.jsx)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:(0,s.jsxs)(c(),{href:"/products",className:"inline-flex items-center text-green-600 hover:text-green-700 cursor-pointer",children:[(0,s.jsx)("i",{className:"ri-arrow-left-line mr-2"}),w("continue_shopping")]})})]})}),(0,s.jsx)("div",{className:"lg:col-span-1",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6 sticky top-8",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:w("subtotal")}),(0,s.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600",children:w("subtotal")}),(0,s.jsxs)("span",{className:"font-medium",children:[_.toLocaleString("uz-UZ")," so'm"]})]}),y>0&&(0,s.jsxs)("div",{className:"flex justify-between text-green-600",children:[(0,s.jsxs)("span",{children:["Chegirma (",(100*y).toFixed(0),"%)"]}),(0,s.jsxs)("span",{children:["-",z.toLocaleString("uz-UZ")," so'm"]})]}),(0,s.jsx)("div",{className:"border-t border-gray-200 pt-4",children:(0,s.jsxs)("div",{className:"flex justify-between text-lg font-semibold",children:[(0,s.jsx)("span",{children:w("total")}),(0,s.jsxs)("span",{children:[q.toLocaleString("uz-UZ")," so'm"]})]})})]}),(0,s.jsx)(c(),{href:"/checkout",className:"w-full bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition-colors text-center block",children:w("proceed_to_checkout")})]})})]})]}),(0,s.jsx)(n.A,{})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[115,425,441,684,358],()=>t(672)),_N_E=e.O()}]);